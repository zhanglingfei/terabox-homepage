// Trilingual Language Switcher for TERABOX Website
// Complete translations for Japanese, English, and Chinese
// Fixed version matching all index.html content

const translations = {
    ja: {
        // Navigation
        'nav-strength': '当社の強み',
        'nav-business-news': '業務新聞',
        'nav-company': '会社概要',
        'nav-message': '代表挨拶',
        'nav-business': '事業内容',
        'nav-cases': '導入実績',
        'nav-recruit': '採用情報',
        'nav-contact': 'お問い合わせ',
        
        // Hero Section
        'hero-title': 'TERABOX',
        'hero-subtitle': '信頼できるITパートナー',
        'hero-description': 'システムエンジニアリング・AI/DXソリューション・スマート機器導入<br>25名以上の専門エンジニアチーム、平均7年以上の業界経験<br>お客様のビジネス課題を解決する一站式ITソリューション',
        'hero-cta': '詳細を見る',
        
        // Strength Section
        'strength-title': '当社の強み',
        'strength-subtitle': 'Our Competitive Advantages',
        'strength-team-title': '多国籍精鋭チーム',
        'strength-team-text': '日本人エンジニアと外国籍エンジニアが協働。官公庁・自治体案件でのプリセールス・提案・要件定義・入札支援等の豊富な実績。グローバルな知見と日本国内公共/民間領域への対応力を両立。',
        'strength-service-title': 'エンドツーエンドサービス',
        'strength-service-text': 'RFP（提案依頼書）・要件定義など上流工程から、技術選定・見積・課題整理・設計～運用まで一貫対応。上流工程経験豊富なPM/PLと最適なチームが高品質プロジェクトを推進。',
        'strength-experience-title': '豊富な業界経験',
        'strength-experience-text': '金融（メガバンク）、医療、物流、製造業など多業界での実績。特に金融・保険業界の経験者が多数在籍していることから、セキュリティに対する高い意識と豊富な知識を保有。',
        
        // Business News Section
        'business-news-title': '業務新聞',
        'business-news-subtitle': 'Latest Business Updates',
        
        // Company Section
        'company-title': '会社概要',
        'company-subtitle': 'Company Information',
        'company-headquarters': '本社',
        'company-subsidiary': '関連会社',
        'company-name-label': '名　称',
        'company-name-value': 'テラボックス株式会社',
        'company-address-label': '所在地',
        'company-address-value': '〒104-0045 東京都中央区築地6丁目17-4<br>リードシー築地ビル 4F',
        'company-tel-label': 'TEL',
        'company-tel-value': '03-5542-7798',
        'company-email-label': 'E-mail',
        'company-email-value': 'info@terabox.jp',
        'company-established-label': '設立日',
        'company-established-value': '平成28年4月',
        'company-capital-label': '資本金',
        'company-capital-value': '2000万円',
        'company-ceo-label': '代表者',
        'company-ceo-value': '花　威',
        'company-certifications-label': '諸資格',
        'company-certifications-value': 'プライバシーマーク 10825028<br>有料職業紹介許可証 13-ユ-309628<br>労働者派遣事業許可証 派13-312878<br>Google Cloud Partner',
        'company-lawyer-label': '顧問弁護士',
        'company-lawyer-value': '飯田綜合法律事務所',
        
        // Message Section
        'message-title': '代表挨拶',
        'message-subtitle': 'Message from CEO',
        'ceo-name': '荊　威',
        'ceo-title': '代表取締役',
        'message-greeting': '拝啓',
        'message-p1': '貴社ますますご清栄のこととお慶び申し上げます。',
        'message-p2': 'このたびテラボックスは、日系企業で長く働きながら日本のビジネスを身に付けた経験豊富な精鋭メンバーの結集により設立させていただきました。今後とも、お客様から信頼されるビジネスパートナーとして真摯に業務に取り組んで参ります。',
        'message-p3': '昨今では外国系のIT企業は乱立気味であり、ともすれば人材を奪い合うような状況に陥りがちな市況でもある中、弊社の創業メンバーは逆転の発想と長い業界経験を活かし、互いに協力関係を築き合えるパートナーネットワークの仕組みを構築いたしました。',
        'message-p4': '優秀なビジネスパートナーとの緊密な連携により、お客様の様々なニーズに対応できる体制を整えております。',
        'message-p5': '弊社の主な事業範囲としては、システムエンジニアリング事業、AI・DXソリューション事業、スマート機器・IoT事業、IT人材サービス事業の四つの柱を軸に事業展開しております。また、特に金融・保険業界の経験者が多数在籍していることから、セキュリティに対する高い意識と豊富な知識も保有しております。',
        'message-p6': '今後とも弊社ならびに弊社ネットワークの経験値と知見を結集し、貴社のご要望に柔軟に対応して参ります。また、それに対応するための十分以上の知力と体力を備えていると自負致しております。貴社のご期待に応えるべく全力を尽くす所存でございますので、何卒ご検討の程宜しくお願い申し上げます。',
        'message-closing': '敬具',
        'message-company': 'テラボックス株式会社',
        'message-signature': '代表取締役　花威',
        
        // Business Section
        'business-title': '事業内容',
        'business-subtitle': 'Our Business Services',
        'business-engineering-title': 'システムエンジニアリング事業',
        'business-engineering-text': '25名以上の多国籍エンジニアチーム、平均業界経験7年以上のプロフェッショナル集団',
        'business-ai-title': 'AI・DXソリューション事業',
        'business-ai-text': 'RFPから運用まで一站式AI/DXソリューション提供',
        'business-iot-title': 'スマート機器・IoT事業',
        'business-iot-text': 'サービスロボット日本初導入のパイオニア',
        'business-hr-title': 'IT人材サービス事業',
        'business-hr-text': '総合的な人材ソリューション提供',
        'business-eb-title': 'Engineering Base',
        'business-eb-text': '統合型エンジニアリング設計プラットフォーム',
        'business-enterprise-title': 'エンタープライズソリューション事業',
        'business-enterprise-text': '企業のデジタル変革を支援する総合ソリューション',
        
        // Cases Section
        'cases-title': '導入実績',
        'cases-subtitle': 'Our Track Record',
        
        // Recruit Section
        'recruit-title': '採用情報',
        'recruit-subtitle': 'Join Our Team',
        'recruit-requirements-title': '募集要項（新卒・中途）',
        'recruit-position-label': '募集職種',
        'recruit-position-value': '①ITエンジニア　②総合職',
        'recruit-hours-label': '勤務時間',
        'recruit-hours-value': '9:00～18:00（休憩1時間）　土日祝日休み　年次有給休暇の計画的付与あり',
        'recruit-hours-note': '※勤務時間・休みは職種や部署によって異なる場合があります。相談可。',
        'recruit-allowance-label': '諸手当',
        'recruit-allowance-value': '通勤手当、家族手当、勤続手当、役職手当等あり',
        'recruit-salary-label': '給与',
        'recruit-salary-new': '新卒',
        'recruit-salary-mid': '中途採用',
        'recruit-salary-mid-range': '年収400～1,000万円',
        'recruit-raise-label': '昇給・昇格',
        'recruit-raise-value': '半期毎評定あり',
        'recruit-trial-label': '試用・研修期間について',
        'recruit-trial-value': '３ヶ月',
        'recruit-vacation-label': '休暇',
        'recruit-vacation-value': '週休2日制　リフレッシュ休暇',
        'recruit-training-label': '研修制度',
        'recruit-training-value': '能力開発体系に基づく研修<br>テクニカルスキル研修<br>eラーニング研修　OJT',
        'recruit-positions-title': '中途採用職種',
        
        // Access Section
        'access-title': 'アクセス',
        'access-subtitle': 'How to reach us',
        'access-company-label': '会社名',
        'access-company-value': 'テラボックス株式会社',
        'access-address-label': '住所',
        'access-address-value': '〒104-0045<br>東京都中央区築地6丁目17-4<br>リードシー築地ビル 4F',
        'access-station-label': '最寄り駅',
        'access-station-value': '東京メトロ日比谷線 築地駅 徒歩5分<br>都営浅草線 東銀座駅 徒歩7分',
        'access-phone-label': '電話番号',
        'access-phone-value': '03-5542-7798',
        'access-hours-label': '営業時間',
        'access-hours-value': '平日 9:00 - 18:00<br>(土日祝日は休業)',
        'access-map-text': 'Google Maps',
        
        // Contact Section
        'contact-title': 'お問い合わせ',
        'contact-subtitle': 'Contact Us',
        'contact-description': 'システム開発、AI/DXソリューション、人材サービスなど、<br>お気軽にご相談ください。',
        'contact-cta': 'お問い合わせする',
        
        // Footer
        'footer-copyright': 'TERABOX Copyright © 2024. All Rights Reserved.'
    },
    
    en: {
        // Navigation
        'nav-strength': 'Our Strengths',
        'nav-business-news': 'Business News',
        'nav-company': 'Company',
        'nav-message': 'CEO Message',
        'nav-business': 'Business',
        'nav-cases': 'Case Studies',
        'nav-recruit': 'Careers',
        'nav-contact': 'Contact',
        
        // Hero Section
        'hero-title': 'TERABOX',
        'hero-subtitle': 'Your Trusted IT Partner',
        'hero-description': 'System Engineering • AI/DX Solutions • Smart Device Implementation<br>25+ Professional Engineers, Average 7+ Years Industry Experience<br>One-Stop IT Solutions for Your Business Challenges',
        'hero-cta': 'Learn More',
        
        // Strength Section
        'strength-title': 'Our Strengths',
        'strength-subtitle': 'Our Competitive Advantages',
        'strength-team-title': 'Multinational Elite Team',
        'strength-team-text': 'Collaboration between Japanese and international engineers. Rich experience in government and municipal projects including presales, proposals, requirements definition, and bidding support. Combining global insights with domestic public/private sector capabilities.',
        'strength-service-title': 'End-to-End Services',
        'strength-service-text': 'Comprehensive support from upstream processes like RFP and requirements definition to technology selection, estimation, issue resolution, design, and operations. Experienced PMs/PLs lead optimal teams for high-quality project delivery.',
        'strength-experience-title': 'Extensive Industry Experience',
        'strength-experience-text': 'Proven track record across finance (megabanks), healthcare, logistics, and manufacturing. Strong security awareness and knowledge from numerous financial and insurance industry veterans.',
        
        // Business News Section
        'business-news-title': 'Business News',
        'business-news-subtitle': 'Latest Business Updates',
        
        // Company Section
        'company-title': 'Company Overview',
        'company-subtitle': 'Company Information',
        'company-headquarters': 'Headquarters',
        'company-subsidiary': 'Subsidiary',
        'company-name-label': 'Company Name',
        'company-name-value': 'Terabox Co., Ltd.',
        'company-address-label': 'Address',
        'company-address-value': '〒104-0045 Tokyo, Chuo City, Tsukiji 6-17-4<br>Reed Sea Tsukiji Building 4F',
        'company-tel-label': 'TEL',
        'company-tel-value': '03-5542-7798',
        'company-email-label': 'E-mail',
        'company-email-value': 'info@terabox.jp',
        'company-established-label': 'Established',
        'company-established-value': 'April 2016',
        'company-capital-label': 'Capital',
        'company-capital-value': '20 Million Yen',
        'company-ceo-label': 'Representative',
        'company-ceo-value': 'Hana Wei',
        'company-certifications-label': 'Certifications',
        'company-certifications-value': 'Privacy Mark 10825028<br>Employment Agency License 13-ユ-309628<br>Worker Dispatch License 派13-312878<br>Google Cloud Partner',
        'company-lawyer-label': 'Legal Advisor',
        'company-lawyer-value': 'Iida Sogo Law Office',
        
        // Message Section
        'message-title': 'Message from CEO',
        'message-subtitle': 'Message from CEO',
        'ceo-name': 'Hana Wei',
        'ceo-title': 'President & CEO',
        'message-greeting': 'Dear Valued Partners,',
        'message-p1': 'We are pleased to see your company continues to prosper.',
        'message-p2': 'Terabox was established through the collaboration of experienced elite members who have long worked in Japanese companies and acquired deep knowledge of Japanese business practices. We will continue to work diligently as a trusted business partner for our customers.',
        'message-p3': 'In recent years, foreign IT companies have become increasingly prevalent, and the market tends to fall into a situation where companies compete for talent. Our founding members have leveraged their reverse thinking and extensive industry experience to build a partner network system that enables mutual cooperation.',
        'message-p4': 'Through close collaboration with excellent business partners, we have established a system that can respond to various customer needs.',
        'message-p5': 'Our main business scope is based on four pillars: System Engineering, AI/DX Solutions, Smart Devices & IoT, and IT Human Resources Services. In addition, since we have many experienced professionals from the financial and insurance industries, we possess high security awareness and extensive knowledge.',
        'message-p6': 'We will continue to combine the experience and knowledge of our company and our network to flexibly respond to your requirements. We are confident that we have more than sufficient intelligence and physical strength to handle this. We will do our best to meet your expectations, so we ask for your kind consideration.',
        'message-closing': 'Sincerely,',
        'message-company': 'Terabox Co., Ltd.',
        'message-signature': 'President & CEO, Hana Wei',
        
        // Business Section
        'business-title': 'Our Business',
        'business-subtitle': 'Our Business Services',
        'business-engineering-title': 'System Engineering',
        'business-engineering-text': '25+ multinational engineers with average 7+ years industry experience',
        'business-ai-title': 'AI/DX Solutions',
        'business-ai-text': 'End-to-end AI/DX solutions from RFP to operations',
        'business-iot-title': 'Smart Devices & IoT',
        'business-iot-text': 'Pioneer in service robot implementation in Japan',
        'business-hr-title': 'IT HR Services',
        'business-hr-text': 'Comprehensive human resource solutions',
        'business-eb-title': 'Engineering Base',
        'business-eb-text': 'Integrated engineering design platform',
        'business-enterprise-title': 'Enterprise Solutions',
        'business-enterprise-text': 'Comprehensive solutions supporting enterprise digital transformation',
        
        // Cases Section
        'cases-title': 'Case Studies',
        'cases-subtitle': 'Our Track Record',
        
        // Recruit Section
        'recruit-title': 'Careers',
        'recruit-subtitle': 'Join Our Team',
        'recruit-requirements-title': 'Job Requirements (New Graduates & Mid-Career)',
        'recruit-position-label': 'Positions',
        'recruit-position-value': '①IT Engineer　②General Position',
        'recruit-hours-label': 'Working Hours',
        'recruit-hours-value': '9:00-18:00 (1 hour break) Weekends and holidays off, planned annual leave available',
        'recruit-hours-note': '※Working hours and holidays may vary by position or department. Negotiable.',
        'recruit-allowance-label': 'Allowances',
        'recruit-allowance-value': 'Transportation, family, service years, position allowances available',
        'recruit-salary-label': 'Salary',
        'recruit-salary-new': 'New Graduates',
        'recruit-salary-mid': 'Mid-Career',
        'recruit-salary-mid-range': 'Annual salary 4-10 million yen',
        'recruit-raise-label': 'Promotion & Raises',
        'recruit-raise-value': 'Semi-annual evaluations',
        'recruit-trial-label': 'Trial/Training Period',
        'recruit-trial-value': '3 months',
        'recruit-vacation-label': 'Holidays',
        'recruit-vacation-value': '5-day work week, refresh leave',
        'recruit-training-label': 'Training System',
        'recruit-training-value': 'Capability development training<br>Technical skills training<br>E-learning, OJT',
        'recruit-positions-title': 'Mid-Career Positions',
        
        // Access Section
        'access-title': 'Access',
        'access-subtitle': 'How to reach us',
        'access-company-label': 'Company Name',
        'access-company-value': 'Terabox Co., Ltd.',
        'access-address-label': 'Address',
        'access-address-value': '〒104-0045<br>6-17-4 Tsukiji, Chuo City, Tokyo<br>Reed Sea Tsukiji Building 4F',
        'access-station-label': 'Nearest Station',
        'access-station-value': 'Tokyo Metro Hibiya Line Tsukiji Station 5 min walk<br>Toei Asakusa Line Higashi-Ginza Station 7 min walk',
        'access-phone-label': 'Phone',
        'access-phone-value': '03-5542-7798',
        'access-hours-label': 'Business Hours',
        'access-hours-value': 'Weekdays 9:00 - 18:00<br>(Closed on weekends and holidays)',
        'access-map-text': 'Google Maps',
        
        // Contact Section
        'contact-title': 'Contact Us',
        'contact-subtitle': 'Contact Us',
        'contact-description': 'System development, AI/DX solutions, HR services, and more.<br>Feel free to contact us for consultation.',
        'contact-cta': 'Contact Us',
        
        // Footer
        'footer-copyright': 'TERABOX Copyright © 2024. All Rights Reserved.'
    },
    
    zh: {
        // Navigation
        'nav-strength': '我们的优势',
        'nav-business-news': '业务新闻',
        'nav-company': '公司概况',
        'nav-message': '总裁致辞',
        'nav-business': '业务内容',
        'nav-cases': '导入案例',
        'nav-recruit': '招聘信息',
        'nav-contact': '联系我们',
        
        // Hero Section
        'hero-title': 'TERABOX',
        'hero-subtitle': '值得信赖的IT合作伙伴',
        'hero-description': '系统工程 • AI/DX解决方案 • 智能设备导入<br>25名以上专业工程师团队，平均7年以上行业经验<br>为您的商业挑战提供一站式IT解决方案',
        'hero-cta': '了解更多',
        
        // Strength Section
        'strength-title': '我们的优势',
        'strength-subtitle': '我们的竞争优势',
        'strength-team-title': '多国籍精英团队',
        'strength-team-text': '日本工程师与外籍工程师协作。在政府和地方自治体项目中拥有丰富的售前、提案、需求定义、招标支持等经验。兼具全球视野和日本国内公共/民间领域的应对能力。',
        'strength-service-title': '端到端服务',
        'strength-service-text': '从RFP（提案请求书）、需求定义等上游工程到技术选型、报价、问题整理、设计到运维的一贯对应。经验丰富的PM/PL带领最适合的团队推进高质量项目。',
        'strength-experience-title': '丰富的行业经验',
        'strength-experience-text': '在金融（大型银行）、医疗、物流、制造业等多个行业拥有实绩。特别是有众多金融保险行业经验者在籍，拥有高度的安全意识和丰富的知识。',
        
        // Business News Section
        'business-news-title': '业务新闻',
        'business-news-subtitle': '最新业务动态',
        
        // Company Section
        'company-title': '公司概况',
        'company-subtitle': '公司信息',
        'company-headquarters': '总部',
        'company-subsidiary': '关联公司',
        'company-name-label': '公司名称',
        'company-name-value': 'Terabox株式会社',
        'company-address-label': '地址',
        'company-address-value': '〒104-0045 东京都中央区筑地6丁目17-4<br>Reed Sea筑地大厦 4F',
        'company-tel-label': '电话',
        'company-tel-value': '03-5542-7798',
        'company-email-label': '邮箱',
        'company-email-value': 'info@terabox.jp',
        'company-established-label': '成立日期',
        'company-established-value': '2016年4月',
        'company-capital-label': '注册资本',
        'company-capital-value': '2000万日元',
        'company-ceo-label': '法人代表',
        'company-ceo-value': '花威',
        'company-certifications-label': '各项资质',
        'company-certifications-value': '隐私标志 10825028<br>收费职业介绍许可证 13-ユ-309628<br>劳动者派遣事业许可证 派13-312878<br>Google Cloud Partner',
        'company-lawyer-label': '法律顾问',
        'company-lawyer-value': '饭田综合法律事务所',
        
        // Message Section
        'message-title': '总裁致辞',
        'message-subtitle': '总裁致辞',
        'ceo-name': '花威',
        'ceo-title': '代表董事',
        'message-greeting': '尊敬的合作伙伴：',
        'message-p1': '很高兴看到贵公司日益繁荣发展。',
        'message-p2': 'Terabox是由在日本企业长期工作并掌握了日本商务知识的经验丰富的精英成员合作成立的。我们将继续作为客户信赖的商业伙伴，真诚地开展业务。',
        'message-p3': '近年来，外资IT企业呈现乱立态势，市场往往陷入人才争夺的局面。我们的创始成员运用逆向思维和丰富的行业经验，构建了能够相互建立合作关系的合作伙伴网络机制。',
        'message-p4': '通过与优秀商业伙伴的紧密合作，我们建立了能够满足客户各种需求的体制。',
        'message-p5': '我们的主要业务范围以系统工程事业、AI·DX解决方案事业、智能设备·IoT事业、IT人才服务事业四大支柱为轴心展开业务。此外，由于有众多金融保险行业经验者在籍，我们也拥有对安全的高度意识和丰富知识。',
        'message-p6': '今后我们将继续结合公司及公司网络的经验值和见解，灵活应对贵公司的要求。我们相信具备了应对这些要求的充分智力和体力。我们将全力以赴满足贵公司的期待，恳请予以考虑。',
        'message-closing': '此致敬礼',
        'message-company': 'Terabox株式会社',
        'message-signature': '代表董事 花威',
        
        // Business Section
        'business-title': '业务内容',
        'business-subtitle': '我们的业务服务',
        'business-engineering-title': '系统工程事业',
        'business-engineering-text': '25名以上多国籍工程师团队，平均行业经验7年以上的专业集团',
        'business-ai-title': 'AI·DX解决方案事业',
        'business-ai-text': '从RFP到运维的一站式AI/DX解决方案提供',
        'business-iot-title': '智能设备·IoT事业',
        'business-iot-text': '服务机器人日本首次导入的先驱',
        'business-hr-title': 'IT人才服务事业',
        'business-hr-text': '提供综合性人才解决方案',
        'business-eb-title': 'Engineering Base',
        'business-eb-text': '集成型工程设计平台',
        'business-enterprise-title': '企业解决方案事业',
        'business-enterprise-text': '支持企业数字化转型的综合解决方案',
        
        // Cases Section
        'cases-title': '导入案例',
        'cases-subtitle': '我们的业绩',
        
        // Recruit Section
        'recruit-title': '招聘信息',
        'recruit-subtitle': '加入我们的团队',
        'recruit-requirements-title': '招聘要求（应届生·社会人士）',
        'recruit-position-label': '招聘职位',
        'recruit-position-value': '①IT工程师　②综合职位',
        'recruit-hours-label': '工作时间',
        'recruit-hours-value': '9:00～18:00（休息1小时）周末节假日休息　年假计划性安排',
        'recruit-hours-note': '※工作时间和休假可能因职位或部门而异。可协商。',
        'recruit-allowance-label': '各种补助',
        'recruit-allowance-value': '交通补助、家庭补助、勤续补助、职位补助等',
        'recruit-salary-label': '薪资',
        'recruit-salary-new': '应届生',
        'recruit-salary-mid': '社会招聘',
        'recruit-salary-mid-range': '年收入400～1000万日元',
        'recruit-raise-label': '晋升加薪',
        'recruit-raise-value': '半年一次评定',
        'recruit-trial-label': '试用培训期间',
        'recruit-trial-value': '3个月',
        'recruit-vacation-label': '休假',
        'recruit-vacation-value': '周休2日制　有调养假',
        'recruit-training-label': '培训制度',
        'recruit-training-value': '基于能力开发体系的培训<br>技术技能培训<br>在线培训　OJT',
        'recruit-positions-title': '社会招聘职位',
        
        // Access Section
        'access-title': '交通指南',
        'access-subtitle': '如何到达',
        'access-company-label': '公司名称',
        'access-company-value': 'Terabox株式会社',
        'access-address-label': '地址',
        'access-address-value': '〒104-0045<br>东京都中央区筑地6丁目17-4<br>Reed Sea筑地大厦 4F',
        'access-station-label': '最近车站',
        'access-station-value': '东京地铁日比谷线 筑地站 步行5分钟<br>都营浅草线 东银座站 步行7分钟',
        'access-phone-label': '电话号码',
        'access-phone-value': '03-5542-7798',
        'access-hours-label': '营业时间',
        'access-hours-value': '工作日 9:00 - 18:00<br>(周末节假日休业)',
        'access-map-text': 'Google Maps',
        
        // Contact Section
        'contact-title': '联系我们',
        'contact-subtitle': '联系我们',
        'contact-description': '系统开发、AI/DX解决方案、人才服务等，<br>欢迎随时咨询。',
        'contact-cta': '联系我们',
        
        // Footer
        'footer-copyright': 'TERABOX Copyright © 2024. All Rights Reserved.'
    }
};

// Language switching core functionality
function switchLanguage(lang) {
    // Validate language parameter
    if (!translations[lang]) {
        console.warn(`Language "${lang}" not supported. Defaulting to Japanese.`);
        lang = 'ja';
    }

    // Update all elements with data-lang-key attribute
    document.querySelectorAll('[data-lang-key]').forEach(element => {
        const key = element.getAttribute('data-lang-key');
        if (translations[lang] && translations[lang][key]) {
            element.innerHTML = translations[lang][key];
        }
    });

    // Update active language button
    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    const activeBtn = document.querySelector(`[data-lang="${lang}"]`);
    if (activeBtn) {
        activeBtn.classList.add('active');
    }

    // Store selected language in localStorage
    try {
        localStorage.setItem('terabox-language', lang);
    } catch (e) {
        console.warn('Unable to save language preference to localStorage:', e);
    }

    // Show language switch notification
    const langText = {
        'ja': '日本語に切り替えました',
        'en': 'Switched to English',
        'zh': '已切换到中文'
    };

    showLanguageNotification(langText[lang]);
}

// Show language switch notification with animation
function showLanguageNotification(message) {
    // Remove existing notification
    const existing = document.querySelector('.lang-notification');
    if (existing) {
        existing.remove();
    }

    const notification = document.createElement('div');
    notification.className = 'lang-notification';
    notification.textContent = message;
    
    // Apply inline styles for the notification
    notification.style.cssText = `
        position: fixed;
        top: 100px;
        right: 20px;
        background: linear-gradient(45deg, #9FD500, #7FB800);
        color: #000;
        padding: 12px 20px;
        border-radius: 6px;
        font-weight: bold;
        z-index: 10000;
        animation: slideInFade 3s ease-out forwards;
        box-shadow: 0 4px 15px rgba(159, 213, 0, 0.3);
        font-size: 14px;
        min-width: 180px;
        text-align: center;
    `;

    document.body.appendChild(notification);

    // Add animation styles if not already present
    if (!document.querySelector('#lang-notification-styles')) {
        const style = document.createElement('style');
        style.id = 'lang-notification-styles';
        style.textContent = `
            @keyframes slideInFade {
                0% { 
                    transform: translateX(100%); 
                    opacity: 0; 
                }
                15% { 
                    transform: translateX(0); 
                    opacity: 1; 
                }
                85% { 
                    transform: translateX(0); 
                    opacity: 1; 
                }
                100% { 
                    transform: translateX(100%); 
                    opacity: 0; 
                }
            }
        `;
        document.head.appendChild(style);
    }

    // Remove notification after animation completes
    setTimeout(() => {
        if (notification.parentNode) {
            notification.remove();
        }
    }, 3000);
}

// Initialize language switching functionality
function initLanguageSwitching() {
    // Load saved language preference or default to Japanese
    let savedLang = 'ja'; // Default language
    
    try {
        savedLang = localStorage.getItem('terabox-language') || 'ja';
    } catch (e) {
        console.warn('Unable to access localStorage:', e);
    }

    // Validate and apply saved language
    if (translations[savedLang]) {
        switchLanguage(savedLang);
    } else {
        switchLanguage('ja');
    }

    // Add event listeners to language buttons
    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
            e.preventDefault();
            const lang = this.getAttribute('data-lang');
            if (lang && translations[lang]) {
                switchLanguage(lang);
            }
        });

        // Add keyboard accessibility
        btn.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                this.click();
            }
        });
    });
}

// Utility function to get current language
function getCurrentLanguage() {
    try {
        return localStorage.getItem('terabox-language') || 'ja';
    } catch (e) {
        return 'ja';
    }
}

// Utility function to get translation for a specific key
function getTranslation(key, lang = null) {
    const currentLang = lang || getCurrentLanguage();
    return translations[currentLang] && translations[currentLang][key] 
        ? translations[currentLang][key] 
        : translations['ja'][key] || key;
}

// Export functions for potential external use
if (typeof module !== 'undefined' && module.exports) {
    module.exports = {
        switchLanguage,
        initLanguageSwitching,
        getCurrentLanguage,
        getTranslation,
        translations
    };
}

// Auto-initialize when DOM is ready
document.addEventListener('DOMContentLoaded', function() {
    initLanguageSwitching();
});

// Export to global scope for direct usage
window.LanguageSwitcher = {
    switchLanguage,
    initLanguageSwitching,
    getCurrentLanguage,
    getTranslation,
    translations
};